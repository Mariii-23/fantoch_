#!/usr/bin/env bash

protocol=$1
release="--release"
features="prof"
leader=""
tracer_show_interval="--tracer_show_interval 10000"
common_args="${leader} ${tracer_show_interval} --processes 3 --faults 1 --workers 1 --executors 1 --multiplexing 1 --tcp_buffer_size 0 --shards 1 --shard_id 0"

case $2 in
1) 
  cd ../fantoch_ps/ && cargo run ${release} --bin ${protocol} --features ${features} -- --id 1 --sorted 1-0,2-0,3-0 --port 3001 --addresses localhost:3002,localhost:3003 --client_port 4001 ${common_args}
  ;;
2)
  cd ../fantoch_ps/ && cargo run ${release} --bin ${protocol} --features ${features} -- --id 2 --sorted 2-0,3-0,1-0 --port 3002 --addresses localhost:3001,localhost:3003 --client_port 4002 ${common_args}
  ;;
3)
  cd ../fantoch_ps/ && cargo run ${release} --bin ${protocol} --features ${features} -- --id 3 --sorted 3-0,1-0,2-0 --port 3003 --addresses localhost:3001,localhost:3002 --client_port 4003 ${common_args}
  ;; 
*)
  echo "process id $0 invalid"
  ;;
esac
